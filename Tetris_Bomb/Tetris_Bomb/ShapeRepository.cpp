#include "ShapeRepository.h"

/*
 * 파일명: ShapeRepository.cpp
 * 설명: 각 블록(I, O, T, L, J, Z, S, Bomb)의 4x4 모양 데이터와
 * 회전 상태, 색상 정보를 실제로 정의하고 반환하는 구현부입니다.
 */

namespace Tetris {

    /*
     * [함수: getShape]
     * 설명: 블록 타입에 따른 4가지 회전 상태의 모양 데이터를 반환합니다.
     * 데이터는 내부 정적 배열(static array)에 저장되어 있어 효율적입니다.
     */
    const ShapeRepository::ShapeRotations& ShapeRepository::getShape(int type) {

        // 블록 모양 정의 (총 8가지: 기본 7개 + 폭탄 1개)
        static const std::array<ShapeRotations, 8> shapes = { {

            // Type 0: I-Shape (긴 막대)
            {{
               {{0,1,0,0, 0,1,0,0, 0,1,0,0, 0,1,0,0}}, // 0도
               {{0,0,0,0, 1,1,1,1, 0,0,0,0, 0,0,0,0}}, // 90도
               {{0,0,1,0, 0,0,1,0, 0,0,1,0, 0,0,1,0}}, // 180도
               {{0,0,0,0, 0,0,0,0, 1,1,1,1, 0,0,0,0}}  // 270도
            }},

            // Type 1: Square (네모)
            {{
               {{1,1,0,0, 1,1,0,0, 0,0,0,0, 0,0,0,0}},
               {{1,1,0,0, 1,1,0,0, 0,0,0,0, 0,0,0,0}},
               {{1,1,0,0, 1,1,0,0, 0,0,0,0, 0,0,0,0}},
               {{1,1,0,0, 1,1,0,0, 0,0,0,0, 0,0,0,0}}
            }},

            // Type 2: T-Shape (T자)
            {{
               {{0,1,0,0, 1,1,0,0, 0,1,0,0, 0,0,0,0}},
               {{1,1,1,0, 0,1,0,0, 0,0,0,0, 0,0,0,0}},
               {{1,0,0,0, 1,1,0,0, 1,0,0,0, 0,0,0,0}},
               {{0,1,0,0, 1,1,1,0, 0,0,0,0, 0,0,0,0}}
            }},

            // Type 3: L-Shape (L자)
            {{
               {{1,1,0,0, 0,1,0,0, 0,1,0,0, 0,0,0,0}},
               {{1,1,1,0, 1,0,0,0, 0,0,0,0, 0,0,0,0}},
               {{1,0,0,0, 1,0,0,0, 1,1,0,0, 0,0,0,0}},
               {{0,0,1,0, 1,1,1,0, 0,0,0,0, 0,0,0,0}}
            }},

            // Type 4: J-Shape (반대 L자)
            {{
               {{1,1,0,0, 1,0,0,0, 1,0,0,0, 0,0,0,0}},
               {{1,0,0,0, 1,1,1,0, 0,0,0,0, 0,0,0,0}},
               {{0,1,0,0, 0,1,0,0, 1,1,0,0, 0,0,0,0}},
               {{1,1,1,0, 0,0,1,0, 0,0,0,0, 0,0,0,0}}
            }},

            // Type 5: Z-Shape (Z자)
            {{
               {{1,1,0,0, 0,1,1,0, 0,0,0,0, 0,0,0,0}},
               {{0,1,0,0, 1,1,0,0, 1,0,0,0, 0,0,0,0}},
               {{1,1,0,0, 0,1,1,0, 0,0,0,0, 0,0,0,0}},
               {{0,1,0,0, 1,1,0,0, 1,0,0,0, 0,0,0,0}}
            }},

            // Type 6: S-Shape (S자)
            {{
               {{0,1,1,0, 1,1,0,0, 0,0,0,0, 0,0,0,0}},
               {{1,0,0,0, 1,1,0,0, 0,1,0,0, 0,0,0,0}},
               {{0,1,1,0, 1,1,0,0, 0,0,0,0, 0,0,0,0}},
               {{1,0,0,0, 1,1,0,0, 0,1,0,0, 0,0,0,0}}
            }},

            // Type 7: Bomb (1x1 중앙 점)
            // 4x4 격자의 (1,1) 위치에 점 하나
            {{
               {{0,0,0,0, 0,1,0,0, 0,0,0,0, 0,0,0,0}},
               {{0,0,0,0, 0,1,0,0, 0,0,0,0, 0,0,0,0}},
               {{0,0,0,0, 0,1,0,0, 0,0,0,0, 0,0,0,0}},
               {{0,0,0,0, 0,1,0,0, 0,0,0,0, 0,0,0,0}}
            }}
        } };

        // 유효하지 않은 타입이 들어오면 기본값(0번) 반환 (안전장치)
        if (type < 0 || type >= shapes.size()) 
            return shapes[0];

        return shapes[type];
    }

    /*
     * [함수: getColorForType]
     * 설명: 블록 타입 번호에 매칭되는 색상 값을 반환합니다.
     */
    Color ShapeRepository::getColorForType(int type) {
        static const Color colors[] = {
            Color::RED,         // 0: I
            Color::BLUE,        // 1: O
            Color::SKY_BLUE,    // 2: T
            Color::WHITE,       // 3: L
            Color::YELLOW,      // 4: J
            Color::VIOLET,      // 5: Z
            Color::GREEN,       // 6: S
            Color::DARK_RED     // 7: Bomb (폭탄)
        };

        // 8가지 색상 순환 (안전장치 포함)
        return colors[type % 8];
    }
}